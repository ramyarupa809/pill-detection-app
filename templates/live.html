<!DOCTYPE html>
<html lang="en">
<head>
    <title>Live Detection</title>
</head>
<body>
    <h2>Live Pill Detection</h2>

    <!-- Laptop Live Video Stream -->
    <h3>Live Webcam (Laptop Only)</h3>
    <img src="{{ url_for('video_feed') }}" style="max-width: 100%;" />

    <!-- Phone Camera Capture -->
    <h3>Mobile Camera Upload</h3>
    <input type="file" id="upload_live" accept="image/*" capture="environment">
    <button onclick="uploadLiveImage()">Upload</button>
    <img id="preview_live" style="max-width: 100%; display: none;">

    <!-- Video Upload -->
    <h3>Upload a Video for Detection</h3>
    <input type="file" id="upload_video" accept="video/*">
    <button onclick="uploadVideo()">Upload</button>

    <script>
        function uploadLiveImage() {
            var fileInput = document.getElementById('upload_live');
            var file = fileInput.files[0];

            if (file) {
                var formData = new FormData();
                formData.append("file", file);

                fetch("/upload_live", {
                    method: "POST",
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    alert("Detection Complete! View Results.");
                    window.location.href = "/detected/" + data.filename;
                })
                .catch(error => console.error("Error:", error));
            } else {
                alert("Please select an image first.");
            }
        }

        function uploadVideo() {
            var fileInput = document.getElementById('upload_video');
            var file = fileInput.files[0];

            if (file) {
                var formData = new FormData();
                formData.append("file", file);

                fetch("/upload_video", {
                    method: "POST",
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    alert("Video Processed! View Results.");
                    window.location.href = "/detected/" + data.filename;
                })
                .catch(error => console.error("Error:", error));
            } else {
                alert("Please select a video first.");
            }
        }
    </script>
</body>
</html>
